#!/usr/bin/env bash

clean() {
  say "Let's clean up this damn mess..."
  rm -rf build > /dev/null 2>&1
}

conf() {
  say "Time to configure this damn beast..."
  local generator=$1
  if [ "$generator" == "ninja" ]; then
    say "Hell yeah, Ninja mode!"
    cmake -B build -S . -G Ninja
  else
    say "Ugh, stuck with Unix Makefiles... just great!"
    cmake -B build -S . -G "Unix Makefiles"
  fi

  if [ $? -ne 0 ]; then
    say "Configuration bombed out! We're screwed!"
    exit 1
  fi
}

build() {
  say "Let's see if this crap actually builds..."
  if ! cmake --build build --parallel 3; then
    say "Build shit the bed!"
    say "I'm outta here!"
    exit 1
  fi
}

doall() {
  say "What a freaking disaster you've got here!"
  clean
  conf "unix"
  build
}

# Clear terminal screen and remove old log files
clear
rm -f logs/*.log > /dev/null 2>&1

case "$1" in
  clean)
    clean
    ;;
  conf)
    conf "$2"
    ;;
  build)
    build
    ;;
  doall)
    doall
    ;;
  *)
    [ ! -d "build" ] && conf "unix"
    build
    ;;
esac

say "All done, about damn time!"